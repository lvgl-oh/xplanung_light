MAP
    NAME "overview"
    STATUS ON
    SIZE 600 600
    MAXSIZE 5000
    UNITS METERS
    PROJECTION
        "init=epsg:4326"
    END
    EXTENT -180 -90 180 90
    WEB	
        IMAGEPATH "/tmp/"
        METADATA
            WMS_TITLE "XPlan Detailanzeige"
            WMS_ABSTRACT "XPlanung-light WMS Detailanzeige"
            WMS_ONLINERESOURCE "<wms_onlineresource>"	
            WMS_SRS "epsg:4326 epsg:25832 epsg:3857 epsg:900913"
            wms_extent "-180 -90 180 90"
            "ows_keywordlist" "XPlanung-light"
            "ows_fees" "none"
            "ows_accessconstraints" "none"
            "ows_addresstype" "postal"
            "ows_address" "Musterstraße 1"
            "ows_city" "Musterstadt"
            "ows_stateorprovince" "Muster Bundesland"
            "ows_postcode" "00000"
            "ows_country" "Germany"
            "ows_contactperson" "Max Mustermann" 
            "ows_contactorganization" "Musterorganisation"
            "ows_contactposition" "Position"
            "ows_contactelectronicmailaddress" "test@example.com"
            "wms_contactfacsimiletelephone" "1111"
            "wms_contactvoicetelephone" "1111"
            "wms_enable_request" "*"
        END
    END
    SYMBOLSET 'xplanung_light/mapserver/symbols/symbols.sym'
    FONTSET 'xplanung_light/mapserver/fonts/fonts.list'
    OUTPUTFORMAT
        NAME 'png'
        DRIVER 'AGG/PNG'
        MIMETYPE 'image/png'
        EXTENSION PNG
        IMAGEMODE PC256
        TRANSPARENT ON
    END
    LEGEND
        STATUS ON
        KEYSIZE 10 8
        KEYSPACING 10 10
        IMAGECOLOR 255 255 255
        LABEL
            COLOR 128 128 128
            TYPE TRUETYPE
            #FONT "arial"
            SIZE 8
        END
    END
    # Inline Polygon Layer auf Basis des Umrings - wird dynamisch in das mapfile geschrieben
    LAYER
        NAME "umring"
        STATUS ON
        TYPE POLYGON
        MAXSCALE 10000000
        FEATURE
            WKT "<wkt>"
        END
        METADATA
            WMS_TITLE       "Umringspolygon"
            WMS_SRS         "EPSG:4326"
            WMS_ABSTRACT    "Umringspolygone des jeweiligen Plans für die Detailanzeige"
            "wms_extent"    "-180 -90 180 90"
        END
        PROJECTION
            "init=epsg:4326"
        END
        CLASS
            NAME "Umringspolygon"
            STYLE
                OUTLINECOLOR 255 0 0 
                WIDTH 2 
            END 
        END
    END
    # Globale Hintergrundkarte auf Basis des BKG Topplus
    LAYER
        NAME "topplus"
        TYPE RASTER
        CONNECTION "https://sgx.geodatenzentrum.de/wms_topplus_web_open?"
        CONNECTIONTYPE WMS
        METADATA
            "wms_srs"             "EPSG:4326"
            "wms_name"            "web_grau"
            "wms_title"           "web_grau"
            "wms_connectiontimeout" "6"
            "wms_server_version"  "1.1.1"
            "wms_format"          "image/png"
            "wms_extent"          "-180 -90 180 90"
        END
    END
    LAYER
        NAME "xplan_fp_bebauung"
        TYPE POLYGON
        CONNECTIONTYPE OGR
        CONNECTION "Flaechennutzungsplan-XPlanung_EPSG25832_GML.gml"
        #DATA "FP_BebauungsFlaeche"
        DATA "fp_bebauungsflaeche"
        METADATA
            WMS_TITLE       "Bebauungspolygone"
            WMS_SRS         "EPSG:25832"
            WMS_ABSTRACT    "Testpolygon"
            "wms_extent"    "361388.1170999999740161 5669905.8633000003173947 382258.3052000000025146 5686629.4944000001996756"
        END
        PROJECTION
            "init=epsg:25832"
        END
        CLASS
            NAME "Bebauungspolygone"
            STYLE
                OUTLINECOLOR 255 0 0 
                WIDTH 2 
            END 
        END
    END
    LAYER
        NAME "xplan_fp_wald"
        TYPE POLYGON
        CONNECTIONTYPE OGR
        CONNECTION "Flaechennutzungsplan-XPlanung_EPSG25832_GML.gml"
        DATA "fp_waldflaeche"
        METADATA
            WMS_TITLE       "Waldpolygone"
            WMS_SRS         "EPSG:25832"
            WMS_ABSTRACT    "Testpolygon"
            "wms_extent"    "361388.1170999999740161 5669905.8633000003173947 382258.3052000000025146 5686629.4944000001996756"
        END
        PROJECTION
            "init=epsg:25832"
        END
        CLASS
            NAME "Waldpolygone"
            STYLE
                OUTLINECOLOR 0 255 0 
                WIDTH 2 
            END 
        END
    END
    LAYER
        NAME "offenlagen"
        TYPE POLYGON
        TEMPLATE "xplanung_light/mapserver/templates/offenlagen.html"
        DUMP TRUE
        CONNECTIONTYPE OGR
        CONNECTION 	"db.sqlite3"
   	    DATA 		"select geltungsbereich, xplanung_light_bplan.id as plan_id from xplanung_light_bplan inner join xplanung_light_bplanbeteiligung on 
                    xplanung_light_bplan.id = xplanung_light_bplanbeteiligung.bplan_id where public = true 
                    and bekanntmachung_datum <= date() and end_datum >= date()
                    union 
                    select geltungsbereich, xplanung_light_fplan.id as plan_id from xplanung_light_fplan inner join xplanung_light_fplanbeteiligung on 
                    xplanung_light_fplan.id = xplanung_light_fplanbeteiligung.fplan_id where public = true
                    and bekanntmachung_datum <= date() and end_datum >= date()
                    "
        METADATA
            WMS_TITLE       "Test Bauleitpläne in Offenlage"
            WMS_SRS         "EPSG:4326"
            WMS_ABSTRACT    "Bauleitpläne in Offenlage - Abstract"
            "wms_extent"    "48 6 52 9"
        END
        PROJECTION
            "init=epsg:4326"
        END
        CLASS
            NAME "Offenlagen"
            STYLE
                OUTLINECOLOR 0 255 255 
                WIDTH 1 
            END 
        END
    END
    LAYER
        NAME "offenlagen_cluster"
        TYPE POINT
        #DEBUG 5
        #CONNECTIONTYPE postgis
        #CONNECTION "user=postgres dbname=baugb_offenlage_rlp host=10.227.0.136 port=5432" # reference to the source layers
        #DATA "the_geom2 from (select *, st_centroid(the_geom) as the_geom2 from offenlagen_baugb_4_a where public is true AND to_timestamp(offenlage_bekanntmachung,'YYYY-MM-DD') <= now()::date and to_timestamp(offenlage_ende,'YYYY-MM-DD') >= now()::date) as foo USING unique id USING SRID=25832"
        CONNECTIONTYPE OGR
        CONNECTION 	"db.sqlite3"
   	    DATA 		"select st_centroid(geltungsbereich), xplanung_light_bplan.id as plan_id from xplanung_light_bplan inner join xplanung_light_bplanbeteiligung on 
                    xplanung_light_bplan.id = xplanung_light_bplanbeteiligung.bplan_id where public = true 
                    and bekanntmachung_datum <= date() and end_datum >= date()
                    union 
                    select st_centroid(geltungsbereich), xplanung_light_fplan.id as plan_id from xplanung_light_fplan inner join xplanung_light_fplanbeteiligung on 
                    xplanung_light_fplan.id = xplanung_light_fplanbeteiligung.fplan_id where public = true
                    and bekanntmachung_datum <= date() and end_datum >= date()
                    "
        
        
        STATUS DEFAULT
        #TEMPLATE "xplanung_light/mapserver/templates/offenlagen.html"
        METADATA
            "wms_title" "Offenlagen von Bauleitplänen gem. §4a (4) BauGB"
            "wms_srs" "EPSG:25832 EPSG:4326 EPSG:31466 EPSG:31467 EPSG:3857"
            'wms_extent'         '270000 5423000 467000 5646000'
            'ows_keywordlist' 'INSPIRE, Download, WMS'
            'wms_abstract' 'INSPIRE Download Layer Abstract 1'
            'ows_enable_request' '!GetCapabilities'
            'wms_encoding' 'UTF-8'
        END
        CLUSTER
            MAXDISTANCE 20
            REGION "ellipse"
        END
        LABELITEM "Cluster_FeatureCount"
        CLASSITEM "Cluster_FeatureCount"
        CLASS
            NAME 'offenlage_multi'
            STYLE
                SYMBOL 'punkt'
                SIZE 30
                COLOR 163 198 117
            END
            STYLE
                SYMBOL 'punkt'
                SIZE 25 #[Cluster:FeatureCount]
                COLOR 110 170 40
            END
            LABEL
                ANTIALIAS true
                ENCODING 'UTF8'
                TYPE truetype
                FONT tahomabold
                SIZE 9
                COLOR 50 50 50
                OUTLINECOLOR 255 255 254
                ALIGN CENTER
                PRIORITY 10
                BUFFER 1
                PARTIALS TRUE
                POSITION cc
            END
        END
    END
END